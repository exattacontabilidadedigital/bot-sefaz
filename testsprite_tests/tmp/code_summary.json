{
  "tech_stack": [
    "Python",
    "FastAPI",
    "Uvicorn",
    "SQLite",
    "Playwright",
    "Docker",
    "Pydantic"
  ],
  "features": [
    {
      "name": "Empresas API",
      "description": "CRUD de empresas com validação e paginação",
      "files": [
        "api.py:158",
        "api.py:216",
        "api.py:277",
        "api.py:314",
        "api.py:347",
        "api.py:414"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "info": { "title": "Empresas API", "version": "1.0.0" },
        "servers": [ { "url": "http://localhost:8000" } ],
        "paths": {
          "/api/empresas": {
            "post": {
              "summary": "Criar empresa",
              "requestBody": {
                "required": true,
                "content": {
                  "application/json": {
                    "schema": { "$ref": "#/components/schemas/EmpresaRequest" }
                  }
                }
              },
              "responses": { "200": { "content": { "application/json": { "schema": { "$ref": "#/components/schemas/EmpresaResponse" } } } } }
            },
            "get": {
              "summary": "Listar empresas",
              "parameters": [
                { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 50 } },
                { "name": "offset", "in": "query", "schema": { "type": "integer", "default": 0 } },
                { "name": "search", "in": "query", "schema": { "type": "string" } },
                { "name": "ativo", "in": "query", "schema": { "type": "boolean" } }
              ],
              "responses": { "200": { "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/EmpresaResponse" } } } } } }
            }
          },
          "/api/empresas/count": {
            "get": {
              "summary": "Contar empresas",
              "parameters": [
                { "name": "search", "in": "query", "schema": { "type": "string" } },
                { "name": "ativo", "in": "query", "schema": { "type": "boolean" } }
              ],
              "responses": { "200": { "content": { "application/json": { "schema": { "type": "object", "properties": { "total": { "type": "integer" } } } } } } }
            }
          },
          "/api/empresas/{id}": {
            "get": {
              "summary": "Obter empresa",
              "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } } ],
              "responses": { "200": { "content": { "application/json": { "schema": { "$ref": "#/components/schemas/EmpresaResponse" } } } } }
            },
            "put": {
              "summary": "Atualizar empresa",
              "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } } ],
              "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/EmpresaRequest" } } } },
              "responses": { "200": { "content": { "application/json": { "schema": { "$ref": "#/components/schemas/EmpresaResponse" } } } } }
            },
            "delete": {
              "summary": "Excluir empresa",
              "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } } ],
              "responses": { "200": { "content": { "application/json": { "schema": { "type": "object" } } } } }
            }
          }
        },
        "components": {
          "schemas": {
            "EmpresaRequest": {
              "type": "object",
              "properties": {
                "nome_empresa": { "type": "string" },
                "cnpj": { "type": "string" },
                "inscricao_estadual": { "type": "string" },
                "cpf_socio": { "type": "string" },
                "senha": { "type": "string" },
                "observacoes": { "type": "string" },
                "ativo": { "type": "boolean" }
              },
              "required": ["nome_empresa", "cnpj", "inscricao_estadual", "cpf_socio", "senha"]
            },
            "EmpresaResponse": {
              "type": "object",
              "properties": {
                "id": { "type": "integer" },
                "nome_empresa": { "type": "string" },
                "cnpj": { "type": "string" },
                "inscricao_estadual": { "type": "string" },
                "cpf_socio": { "type": "string" },
                "data_criacao": { "type": "string" },
                "data_atualizacao": { "type": "string" },
                "ativo": { "type": "boolean" },
                "observacoes": { "type": "string" }
              }
            }
          }
        }
      }
    },
    {
      "name": "Consultas API",
      "description": "Listagem e exclusão de consultas com filtros",
      "files": [
        "api.py:474",
        "api.py:574",
        "api.py:602"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "info": { "title": "Consultas API", "version": "1.0.0" },
        "servers": [ { "url": "http://localhost:8000" } ],
        "paths": {
          "/api/consultas": {
            "get": {
              "summary": "Listar consultas (últimas por IE)",
              "parameters": [
                { "name": "limit", "in": "query", "schema": { "type": "integer", "default": 50 } },
                { "name": "offset", "in": "query", "schema": { "type": "integer", "default": 0 } },
                { "name": "search", "in": "query", "schema": { "type": "string" } },
                { "name": "status", "in": "query", "schema": { "type": "string" } },
                { "name": "tem_tvi", "in": "query", "schema": { "type": "string" } },
                { "name": "tem_divida", "in": "query", "schema": { "type": "string" } }
              ],
              "responses": { "200": { "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/ConsultaResponse" } } } } } }
            }
          },
          "/api/consultas/{id}": {
            "delete": { "summary": "Excluir consulta", "parameters": [ { "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } } ], "responses": { "200": { "content": { "application/json": { "schema": { "type": "object" } } } } } }
          },
          "/api/consultas/count": {
            "get": { "summary": "Contar consultas (últimas por IE)", "responses": { "200": { "content": { "application/json": { "schema": { "type": "object", "properties": { "total": { "type": "integer" } } } } } } } }
          }
        },
        "components": {
          "schemas": {
            "ConsultaResponse": {
              "type": "object",
              "properties": {
                "id": { "type": "integer" },
                "nome_empresa": { "type": "string" },
                "cnpj": { "type": "string" },
                "inscricao_estadual": { "type": "string" },
                "cpf_socio": { "type": "string" },
                "chave_acesso": { "type": "string" },
                "status_ie": { "type": "string" },
                "tem_tvi": { "type": "string" },
                "valor_debitos": { "type": "number" },
                "tem_divida_pendente": { "type": "string" },
                "omisso_declaracao": { "type": "string" },
                "inscrito_restritivo": { "type": "string" },
                "data_consulta": { "type": "string" }
              }
            }
          }
        }
      }
    },
    {
      "name": "Fila de Processamento API",
      "description": "Gerenciamento de fila de jobs (adicionar, listar, stats, iniciar/parar, cancelar)",
      "files": [
        "api.py:791",
        "api.py:855",
        "api.py:905",
        "api.py:1067",
        "api.py:1080",
        "api.py:1092",
        "api.py:1123"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "info": { "title": "Fila API", "version": "1.0.0" },
        "servers": [ { "url": "http://localhost:8000" } ],
        "paths": {
          "/api/fila/adicionar": { "post": { "summary": "Adicionar empresas à fila", "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/QueueJobRequest" } } } }, "responses": { "200": { "content": { "application/json": { "schema": { "type": "object" } } } } } } },
          "/api/fila": { "get": { "summary": "Listar fila", "responses": { "200": { "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/QueueJobResponse" } } } } } } } },
          "/api/fila/stats": { "get": { "summary": "Estatísticas", "responses": { "200": { "content": { "application/json": { "schema": { "type": "object" } } } } } } },
          "/api/fila/iniciar": { "post": { "summary": "Iniciar processamento", "responses": { "200": { "content": { "application/json": { "schema": { "type": "object" } } } } } } },
          "/api/fila/parar": { "post": { "summary": "Parar processamento", "responses": { "200": { "content": { "application/json": { "schema": { "type": "object" } } } } } } },
          "/api/fila/{job_id}": { "delete": { "summary": "Deletar job", "parameters": [ { "name": "job_id", "in": "path", "required": true, "schema": { "type": "integer" } } ], "responses": { "200": { "content": { "application/json": { "schema": { "type": "object" } } } } } } },
          "/api/fila/cancelar/{job_id}": { "post": { "summary": "Cancelar job", "parameters": [ { "name": "job_id", "in": "path", "required": true, "schema": { "type": "integer" } } ], "responses": { "200": { "content": { "application/json": { "schema": { "type": "object" } } } } } } }
        },
        "components": {
          "schemas": {
            "QueueJobRequest": {
              "type": "object",
              "properties": {
                "empresa_ids": { "type": "array", "items": { "type": "integer" } },
                "prioridade": { "type": "integer" }
              },
              "required": ["empresa_ids"]
            },
            "QueueJobResponse": {
              "type": "object",
              "properties": {
                "id": { "type": "integer" },
                "empresa_id": { "type": "integer" },
                "nome_empresa": { "type": "string" },
                "cnpj": { "type": "string" },
                "inscricao_estadual": { "type": "string" },
                "status": { "type": "string" },
                "prioridade": { "type": "integer" },
                "data_adicao": { "type": "string" },
                "data_processamento": { "type": "string" },
                "tentativas": { "type": "integer" },
                "max_tentativas": { "type": "integer" },
                "erro": { "type": "string" }
              }
            }
          }
        }
      }
    },
    {
      "name": "Status e Estatísticas API",
      "description": "Status da execução e estatísticas agregadas",
      "files": [
        "api.py:661",
        "api.py:738"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "info": { "title": "Status & Estatísticas", "version": "1.0.0" },
        "servers": [ { "url": "http://localhost:8000" } ],
        "paths": {
          "/api/status": { "get": { "summary": "Status da consulta", "responses": { "200": { "content": { "application/json": { "schema": { "$ref": "#/components/schemas/StatusResponse" } } } } } } },
          "/api/estatisticas": { "get": { "summary": "Estatísticas das consultas (últimas por IE)", "responses": { "200": { "content": { "application/json": { "schema": { "type": "object" } } } } } } }
        },
        "components": {
          "schemas": {
            "StatusResponse": {
              "type": "object",
              "properties": {
                "status": { "type": "string" },
                "message": { "type": "string" },
                "data": { "type": "object" }
              }
            }
          }
        }
      }
    },
    {
      "name": "Mensagens SEFAZ API",
      "description": "Listagem, contagem e obtenção de mensagens SEFAZ",
      "files": [
        "api.py:1168",
        "api.py:1241",
        "api.py:1278"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "info": { "title": "Mensagens SEFAZ", "version": "1.0.0" },
        "servers": [ { "url": "http://localhost:8000" } ],
        "paths": {
          "/api/mensagens": { "get": { "summary": "Listar mensagens", "responses": { "200": { "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/MensagemSefazResponse" } } } } } } } },
          "/api/mensagens/count": { "get": { "summary": "Contar mensagens", "responses": { "200": { "content": { "application/json": { "schema": { "type": "object", "properties": { "total": { "type": "integer" } } } } } } } } },
          "/api/mensagens/{mensagem_id}": { "get": { "summary": "Obter mensagem", "parameters": [ { "name": "mensagem_id", "in": "path", "required": true, "schema": { "type": "integer" } } ], "responses": { "200": { "content": { "application/json": { "schema": { "$ref": "#/components/schemas/MensagemSefazResponse" } } } } } } }
        },
        "components": {
          "schemas": {
            "MensagemSefazResponse": {
              "type": "object",
              "properties": {
                "id": { "type": "integer" },
                "inscricao_estadual": { "type": "string" },
                "cpf_socio": { "type": "string" },
                "enviada_por": { "type": "string" },
                "data_envio": { "type": "string" },
                "assunto": { "type": "string" },
                "classificacao": { "type": "string" },
                "tributo": { "type": "string" },
                "tipo_mensagem": { "type": "string" },
                "numero_documento": { "type": "string" },
                "vencimento": { "type": "string" },
                "tipo_ciencia": { "type": "string" },
                "data_ciencia": { "type": "string" },
                "conteudo_mensagem": { "type": "string" },
                "data_leitura": { "type": "string" }
              }
            }
          }
        }
      }
    },
    {
      "name": "Consulta em Background",
      "description": "Disparo de consulta SEFAZ em background",
      "files": [
        "api.py:675",
        "api.py:703",
        "bot.py:1"
      ],
      "api_doc": {
        "openapi": "3.0.0",
        "info": { "title": "Consulta Background", "version": "1.0.0" },
        "servers": [ { "url": "http://localhost:8000" } ],
        "paths": {
          "/api/consulta": {
            "post": {
              "summary": "Executar consulta",
              "requestBody": {
                "required": true,
                "content": {
                  "application/json": {
                    "schema": { "$ref": "#/components/schemas/ConsultaRequest" }
                  }
                }
              },
              "responses": { "200": { "content": { "application/json": { "schema": { "$ref": "#/components/schemas/StatusResponse" } } } } }
            }
          }
        },
        "components": {
          "schemas": {
            "ConsultaRequest": {
              "type": "object",
              "properties": {
                "usuario": { "type": "string" },
                "senha": { "type": "string" },
                "inscricao_estadual": { "type": "string" },
                "headless": { "type": "boolean" }
              }
            }
          }
        }
      }
    }
  ]
}
